plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

group = 'com.ikingsnipe'
version = '1.1.0'

sourceCompatibility = JavaVersion.VERSION_11
targetCompatibility = JavaVersion.VERSION_11

repositories {
    mavenCentral()
}

dependencies {
    // Use the local DreamBot API JAR
    implementation files('libs/dreambot-api.jar')
    
    // Essential utilities
    implementation 'com.google.guava:guava:31.1-jre'
    
    // Logging
    implementation 'org.slf4j:slf4j-api:2.0.5'
    implementation 'org.slf4j:slf4j-simple:2.0.5'
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
    options.compilerArgs = ['-Xlint:unchecked', '-Xlint:deprecation']
}

jar {
    manifest {
        attributes(
            'Implementation-Title': 'Elite Titan Casino',
            'Implementation-Version': project.version,
            'Main-Class': 'com.ikingsnipe.EliteTitanCasino'
        )
    }
}

shadowJar {
    archiveClassifier = ''
    archiveFileName = "EliteTitanCasino-${project.version}.jar"
    
    // Relocate dependencies to avoid conflicts
    relocate 'com.google', 'com.ikingsnipe.repackaged.google'
    relocate 'org.slf4j', 'com.ikingsnipe.repackaged.slf4j'
    
    // Exclude the DreamBot API from the fat JAR as it's provided by the client
    dependencies {
        exclude(dependency(files('libs/dreambot-api.jar')))
    }
}

// Ensure shadowJar is built when running build
build.dependsOn shadowJar
