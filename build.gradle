plugins {
    id 'java'
    id 'application'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

group = 'com.ikingsnipe'
version = '1.0.0'
sourceCompatibility = JavaVersion.VERSION_11
targetCompatibility = JavaVersion.VERSION_11

repositories {
    mavenCentral()
    maven {
        url 'https://repo.dreambot.io/artifactory/public'
        credentials {
            username System.getenv('DREAMBOT_REPO_USER') ?: 'guest'
            password System.getenv('DREAMBOT_REPO_PASS') ?: 'guest'
        }
    }
}

dependencies {
    // DreamBot 4.0+ API
    implementation files('libs/dreambot-api.jar')
    
    // Java Utilities
    implementation 'com.google.guava:guava:31.1-jre'
    
    // Logging
    implementation 'org.slf4j:slf4j-api:2.0.5'
    implementation 'org.slf4j:slf4j-simple:2.0.5'
    
    // Testing
    testImplementation 'junit:junit:4.13.2'
    testImplementation 'org.mockito:mockito-core:5.2.0'
}

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
    options.compilerArgs = ['-Xlint:unchecked', '-Xlint:deprecation']
}

jar {
    manifest {
        attributes(
            'Main-Class': 'com.ikingsnipe.Main',
            'Implementation-Title': project.name,
            'Implementation-Version': project.version,
            'Built-By': System.getProperty('user.name'),
            'Build-Timestamp': new Date().format('yyyy-MM-dd\'T\'HH:mm:ss.SSSZ')
        )
    }
}

shadowJar {
    archiveClassifier = 'fat'
    manifest {
        inheritFrom jar.manifest
    }
    mergeServiceFiles()
}

tasks.build.dependsOn shadowJar

application {
    mainClass = 'com.ikingsnipe.Main'
}

// task wrapper(type: Wrapper) {
//     gradleVersion = '8.5'
// }

// Compilation settings
compileJava {
    options.compilerArgs.add('-parameters')
}

// Run configuration
run {
    standardInput = System.in
}

// Test configuration
test {
    useJUnit()
    testLogging {
        events "passed", "skipped", "failed"
        exceptionFormat "full"
    }
}
